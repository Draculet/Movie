* 1.客户端和服务端的连接是长连接,连接建立后客户端就发送请求查询座位是否售出,服务端检查所需信息是否已缓存,如未缓存则读数据库(mysql capi的init和real_connect函数需要加锁),取得数据后发送给客户端,客户端接受数据后继续不停查询,直到超时(runAfter(timeoutcallback)).
* 2.首先由于sockfd数的限制,最大连接数目前只能到70000连接,但是经测试70000连接无法同时建立,原因是端口用尽(FROM:https://blog.csdn.net/u010585120/article/details/80826999),首先通过sysctl -a|grep net.ipv4.ip_local_port_range命令可知可用端口范围net.ipv4.ip_local_port_range = 32768	60999，可用端口数仅有28233个,另外由于TIME_WAIT状态的存在,连接断开后无法马上复用该端口,需要等待60s(使用netstat -an|awk '/tcp/ {print $6}'|sort|uniq -c可查看处于各种连接状态的连接数),所以一开始进行70000连接测试,结果是连接无法全部建立,仅有最多50000的连接能建立成功,而超时时间到后,由于客户端仅shutdown(wr)已建立的连接,当那些建立的连接超时释放后,原来在等待的连接建立起来,客户端和服务端陷入一读一写的循环,不再有超时,连接也无法正常断开.因为time_wait的存在,端口不会被复用,新连接的建立推测是由于超时的连接不再占用cpu时间,时间片交给了acceptor,新连接得以建立.
* 3.当测试70000连接测试时,大部分情况无法达到28233个连接同时建立的极限值,推测是由于工作线程占用太多时间片,但是后续超时后,经过一段时间即可达到极限,在超时时间内也有一定几率达到极限
* 4.当测试20000,20010,20100等低于极限的值时,就可很好地达到全部连接都建立的情况,并且能正常退出,不管如何timewait和establish的连接之和不会超过极限28233

参考:http://bbs.chinaunix.net/thread-3757024-1-1.html
	 https://www.cnblogs.com/sidesky/p/6844565.html
	 https://www.cnblogs.com/tiantiandas/p/time_wait.html
	 https://blog.csdn.net/u010585120/article/details/80826999
	 https://www.cnblogs.com/shijingxiang/articles/4701722.html


